## 2.2 Transaktionskontrolle

Bei Datenbanken spielt die Transaktionskontrolle eine sehr große Rolle. Die Konsistenz der Datenbank muss vor und nach der Transaktion gegeben sein. Daher gibt es viele Mechanismen, die für die Konsistenz der Datenbank sorgen.

Bei verteilten Datenbanken ist die Transaktionskontrolle noch aufwendiger, da sichergestellt sein muss, dass die Daten auf allen Systemen konsistent sind. Verteilte Datenbanken arbeiten mit dem sogenannten 2-Phasen-Commit Protokoll (Two Phase-Commit). Das 2-Phasen-Commit gibt es in verschiedenen Ausprägungen. Es wird je nach Datenbankhersteller unterschiedlich verfeinert. Eine Basis-Version ist in allen verteilten Datenbanken vorhanden. Diese Version des Protokolls enthält 2 Phasen, woher auch der Name abstammt. Die erste Phase ist die Abstimmungsphase. In dieser Phase sendet ein Koordinator (ein Knoten im verteilten System, der als Koordinator agiert) eine PREPARE Nachricht an alle weiteren Knoten, um sie über die anstehende Transaktion zu informieren. Die weiteren Knoten im verteilten System werden Agenten genannt. Die Agenten stellen die Wiederholbarkeit und Rückgängigmachung der Transaktion sicher, indem sie UNDO und REDO Logs schreiben. Dazu verwenden sie den Befehl DO, mit dessen Hilfe die Kommandos in die Logs geschrieben werden. Nach der Fertigstellung der Logs senden die Agenten eine READY Nachricht an den Koordinator. Sollte die Transaktion nicht möglich sein, wird stattdessen eine FAILED Nachricht geschickt. Wenn alle Agenten ein READY gesendet haben, sendet der Koordinator ein COMMIT an die Agenten, wodurch die Commitphase beginnt. Wenn nicht alle Agenten eine READY Nachricht gesendet haben, schickt der Koordinator stattdessen eine ABORT Nachricht, die dazu führt, dass die Transkation abgebrochen wird. Wurde die Commitphase begonnen, setzen die Agenten die Transaktionen um und senden nach erfolgreicher Umsetzung ein ACK Flag zum Koordinator. Sobald der Koordinator von allen Agenten ein entsprechendes ACK Flag erhalten hat, ist die Transaktion erfolgreich abgeschlossen. Sollte er nicht von allen Systemen ein Ack Flag erhalten, kann die Änderung über die UNDO Logs wieder rückgängig gemacht werden.

-----
[Zurück](2.1_Arten_von_verteilten_Datenbanken.md) | [Weiter](3_Middleware.md)

[Zum Inhaltsverzeichnis](README.md)